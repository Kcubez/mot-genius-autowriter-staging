{% extends "layout.html" %} 
{% block title %}Login - Genius AutoWriter{% endblock %} 
{% block content %}
<div class="flex-1 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md sm:max-w-lg lg:max-w-4xl w-full">
      <div
        class="backdrop-blur-sm p-8 sm:p-10 lg:p-16 rounded-2xl shadow-2xl"
        style="background-color: rgba(0, 0, 0, 0.8); border: 1px solid rgba(220, 38, 38, 0.4)"
      >
        <!-- Logo in Card -->
        <div class="text-center mb-8">
          <div class="mb-4 flex justify-center">
            <img
              src="{{ url_for('static', filename='images/mot-logo_cropped.png') }}"
              alt="MOT Logo"
              class="h-12 lg:h-16 w-auto object-contain"
            />
          </div>
          <h2 class="text-2xl lg:text-3xl font-bold text-white mb-2" data-translate="Welcome Back">
            Welcome Back
          </h2>
          <p class="text-red-600 font-bold text-xl lg:text-2xl" data-translate="Genius Autowriter">
            Genius Autowriter
          </p>
        </div>
        <!-- Login Form -->
        <div class="max-w-xl mx-auto">
        <form method="POST" class="login-form space-y-6" id="loginForm">
          {{ form.hidden_tag() }}

          <div class="form-field">
            <label
              for="email"
              class="block text-sm lg:text-base font-medium text-white mb-2"
              data-translate="Email"
              >Email</label
            >
            {{ form.email(class="w-full px-4 py-3 lg:px-5 lg:py-3.5 lg:text-base border-0 border-b-2 border-red-600 rounded-lg focus:outline-none focus:border-red-500 transition-all duration-200 bg-white text-black placeholder-gray-400", onkeydown="return preventSpaceKey(event)", oninput="cleanInput(event)", onpaste="setTimeout(() => cleanInput(event), 10)", autocomplete="email", **{"data-translate-placeholder": "Enter your email"}) }} {% if
            form.email.errors %}
            <div class="text-red-400 text-sm mt-1">
              {% for error in form.email.errors %}
              <p>{{ error }}</p>
              {% endfor %}
            </div>
            {% endif %}
          </div>

          <div class="form-field">
            <label
              for="password"
              class="block text-sm lg:text-base font-medium text-white mb-2"
              data-translate="Password"
              >Password</label
            >
            <div class="relative">
              {{ form.password(class="w-full px-4 py-3 lg:px-5 lg:py-3.5 lg:text-base pr-12 border-0 border-b-2 border-red-600 rounded-lg focus:outline-none focus:border-red-500 transition-all duration-200 bg-white text-black placeholder-gray-400", id="password-field", onkeydown="return preventSpaceKey(event)", oninput="cleanInput(event)", onpaste="setTimeout(() => cleanInput(event), 10)", autocomplete="current-password", **{"data-translate-placeholder": "Enter your password"}) }}
              <button
                type="button"
                class="password-toggle absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700"
                onclick="togglePasswordVisibility()"
              >
                <!-- Eye Open Icon -->
                <svg
                  id="eye-open"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  style="width: 20px; height: 20px"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                  />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                  />
                </svg>
                <!-- Eye Closed Icon -->
                <svg
                  id="eye-closed"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  style="width: 20px; height: 20px; display: none"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"
                  />
                </svg>
              </button>
            </div>
            {% if form.password.errors %}
            <div class="text-red-400 text-sm mt-1">
              {% for error in form.password.errors %}
              <p>{{ error }}</p>
              {% endfor %}
            </div>
            {% endif %}
          </div>

          <div class="form-field">
            <label
              for="api_key"
              class="block text-sm lg:text-base font-medium text-white mb-2"
              data-translate="Gemini API Key"
              >Gemini API Key</label
            >
            {{ form.api_key(class="w-full px-4 py-3 lg:px-5 lg:py-3.5 lg:text-base border-0 border-b-2 border-red-600 rounded-lg focus:outline-none focus:border-red-500 transition-all duration-200 bg-white text-black placeholder-gray-400", **{"data-translate-placeholder": "Enter Gemini API Key"}) }} {%
            if form.api_key.errors %}
            <div class="text-red-400 text-sm mt-1">
              {% for error in form.api_key.errors %}
              <p>{{ error }}</p>
              {% endfor %}
            </div>
            {% endif %}
          </div>

          <div class="form-field flex items-center">
            <label class="flex items-center cursor-pointer">
              {{ form.remember_me(class="w-4 h-4 mr-2 text-red-600 bg-white border-gray-300 rounded focus:ring-red-500 focus:ring-2") }}
              <span class="text-sm lg:text-base text-white">Remember me</span>
            </label>
          </div>

          <div class="flex justify-center">
            <button
              type="submit"
              id="loginButton"
              class="bg-red-600 hover:bg-red-700 text-white py-3 lg:py-3.5 px-6 lg:px-8 lg:text-base rounded-lg font-semibold transition-all duration-200 shadow-lg whitespace-nowrap"
              style="min-width: 200px; width: auto;"
            >
              <svg id="loginSpinner" class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" style="display: none; margin-right: 8px;">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              <span id="loginButtonText" data-translate="Login">Login</span>
            </button>
          </div>
          <style>
            @media (min-width: 1024px) {
              #loginButton {
                min-width: 250px !important;
              }
            }
          </style>
        </form>
        </div>

        <!-- Footer in Card -->
        <div class="mt-6 text-center">
          <p class="text-gray-400 text-xs" data-translate="Powered by Myanmar Online Technology">
            Powered by Myanmar Online Technology
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function togglePasswordVisibility() {
    const passwordField = document.getElementById('password-field');
    const eyeOpen = document.getElementById('eye-open');
    const eyeClosed = document.getElementById('eye-closed');

    if (passwordField.type === 'password') {
      passwordField.type = 'text';
      eyeOpen.style.display = 'none';
      eyeClosed.style.display = 'block';
    } else {
      passwordField.type = 'password';
      eyeOpen.style.display = 'block';
      eyeClosed.style.display = 'none';
    }
  }

  // Prevent space key in password and email fields
  function preventSpaceKey(event) {
    // Check if the pressed key is space (keyCode 32 or key ' ')
    if (event.keyCode === 32 || event.key === ' ' || event.key === 'Spacebar') {
      // Prevent the default action (typing the space)
      event.preventDefault();
      event.stopPropagation();
      return false;
    }
    return true;
  }

  // Additional function to clean input on paste and input events
  function cleanInput(event) {
    const input = event.target;
    // Remove all spaces from the input value
    input.value = input.value.replace(/\s/g, '');
  }

  // Login form submission with loading animation
  document.getElementById('loginForm').addEventListener('submit', function(e) {
    const loginButton = document.getElementById('loginButton');
    const loginSpinner = document.getElementById('loginSpinner');
    const loginButtonText = document.getElementById('loginButtonText');
    
    // Disable button
    loginButton.disabled = true;
    loginButton.style.opacity = '0.7';
    loginButton.style.cursor = 'not-allowed';
    
    // Show spinner
    loginSpinner.style.display = 'inline-block';
    
    // Change text to "Logging in..." with proper translation
    loginButtonText.setAttribute('data-translate', 'Logging in...');
    
    // Get current language from localStorage (key is 'language' not 'selectedLanguage')
    const currentLang = localStorage.getItem('language') || 'my';
    
    // Apply translation immediately
    if (window.translations && window.translations['Logging in...']) {
      loginButtonText.textContent = window.translations['Logging in...'][currentLang];
    } else {
      // Fallback if translations not loaded yet
      if (currentLang === 'my') {
        loginButtonText.textContent = 'လော့ဂ်အင်ဝင်နေသည်...';
      } else {
        loginButtonText.textContent = 'Logging in...';
      }
    }
  });
</script>

{% endblock %}
